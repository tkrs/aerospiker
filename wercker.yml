box: hseeberger/scala-sbt
services:
  - aerospike/aerospike-server

build:
  steps:
    - script:
        name: noop
        code: |
          :
test:
  steps:
    - script:
        name: sbt test
        code: |
          sbt coverage test coverageReport
    - script:
        name: push coverage report to codecov
        code: |
          bash <(curl -s https://codecov.io/bash)
test_211:
  steps:
    - script:
        name: sbt test
        code: |
          sbt ++2.11.11 test
deploy:
  steps:
    - script:
        name: setup gpg secring.asc
        code: |
          gpg_key_path=$HOME/.sbt/gpg
          mkdir -p $gpg_key_path
          echo $GPG_KEY | base64 --decode > $gpg_key_path/secring.asc
    - script:
        name: deploy to snapshot repository
        code: |
          if [[ $(cat version.sbt) =~ "-SNAPSHOT" ]]; then
            sbt publishSigned
          fi
deploy_211:
  steps:
    - script:
        name: setup gpg secring.asc
        code: |
          gpg_key_path=$HOME/.sbt/gpg
          mkdir -p $gpg_key_path
          echo $GPG_KEY | base64 --decode > $gpg_key_path/secring.asc
    - script:
        name: deploy to snapshot repository
        code: |
          if [[ $(cat version.sbt) =~ "-SNAPSHOT" ]]; then
            sbt ++2.11.11 publishSigned
          fi
